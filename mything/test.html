
<p>MediaWiki stores some data in the local filesystem. If you were to use <a href="webserver_clustering" title="wikilink">webserver clustering</a> to serve a big wiki, you'd want to take this into account.</p>
<h2 id="user-accessible-files">User-accessible files</h2>
<h3 id="uploaded-media-files"><a href=":m:Help:Images_and_other_uploaded_files" title="wikilink">Uploaded media files</a></h3>
<p>These go into a directory specified by <a href="Manual:LocalSettings.php" title="wikilink">LocalSettings.php</a>, which is usually called “<code>upload</code>”. Filenames are <a href="w:MD5" title="wikilink">MD5</a>-hashed, and since many filesystems don't handle large directories well, uploads are broken into subdirectories with the first and first two hex digits of the hash, e.g.:</p>
<ul>
<li><a href="http://meta.wikipedia.org/upload/7/79/Wikicontestlogo598932.jpg">upload/7/79/Wikicontestlogo598932.jpg</a></li>
<li><a href="http://meta.wikipedia.org/upload/a/a6/Stygian_Wiki_Logo_Proto_Grey.png">upload/a/a6/Stygian_Wiki_Logo_Proto_Grey.png</a></li>
<li><a href="http://meta.wikipedia.org/upload/f/fb/Wikipedia_sub.jpg">upload/f/fb/Wikipedia_sub.jpg</a></li>
</ul>
<p><strong>Security note:</strong> Even though the upload system contains a <a href=":m:Upload#Uploading_non-image_files" title="wikilink">filetype blacklist</a>, you should ensure that your webserver is not configured to execute PHP or CGI scripts in the upload directory, just in case. Other filetypes may be unsafe downloads for some client systems.</p>
<p>Note. To add a direct link to a file you can use the following syntax:</p>
<pre><code>{{filepath:file name}}</code></pre>
<p>For example: <code>{{filepath:Wiki.png}}</code> → .</p>
<p>See also: <a href="Help:Variables#URL_data" title="wikilink">Help:Variables#URL data</a>.</p>
<h3 id="archived-uploads">Archived uploads</h3>
<p>When a new version of a file is uploaded, the old one is moved into the <code>upload/archive directory</code>, with its timestamp and “!” prepended. Again, hash subdirs are used:</p>
<ul>
<li><a href="http://meta.wikipedia.org/upload/8/85/Edit_this_page_intl.png">upload/8/85/Edit_this_page_intl.png</a> - current revision</li>
<li><a href="http://meta.wikipedia.org/upload/archive/8/85/20030628125544!Edit_this_page_intl.png">upload/archive/8/85/20030628125544!Edit_this_page_intl.png</a> - archived revision</li>
</ul>
<h3 id="rasterized-tex">Rasterized TeX</h3>
<p><a href="texvc" class="uri" title="wikilink">texvc</a> generates rasterized PNG images from inline TeX code (if this option is enabled). These are dumped in a web-accessible <a href="Manual:LocalSettings.php" title="wikilink">LocalSettings.php</a>-specified directory, usually called “math”.</p>
<p>The filename is the hex MD5 hash of the normalized TeX input, plus “.png”:</p>
<ul>
<li><a href="http://meta.wikipedia.org/math/47e7849b634fe4487aaf981b32825e18.png">math/47e7849b634fe4487aaf981b32825e18.png</a></li>
</ul>
<p>These files just accumulate, and are not automatically removed if the equations they represent are removed from articles (or existed only during preview rendering).</p>
<p>The images can be manually deleted, since the wiki can regenerate them, but if you do you'll want to fix the database as well:</p>
<ul>
<li>Clear the affected entries in the <a href="math_table" title="wikilink">math table</a>, or the wiki will think it's already rendered those bits
<ul>
<li><em>TODO: doublecheck that the file exists before deciding that an entry in the math table is valid</em></li>
</ul></li>
<li>If using <a href="file_cache" title="wikilink">file caching</a>, do one of the following to invalidate the cached pages or visits by anon users won't trigger regeneration of the images:
<ul>
<li>remove all (affected) pages from the cache (consider grep)</li>
<li>Update cur_touched fields to present time for affected entries (check for “&lt;math&gt;” in cur_text)</li>
<li>Update the global $wgCacheEpoch timestamp in LocalSettings, forcing all cached pages to be regenerated without going to the bother of deleting anything.</li>
</ul></li>
</ul>
<h2 id="semi-private-files">Semi-private files</h2>
<h3 id="file-cache">File cache</h3>
<p>Optionally, rendered HTML pages may be kept in a cache directory and served to anonymous visitors. See more details at <a href="Manual:File_cache" title="wikilink">File cache</a>.</p>
<h3 id="read-only-lock-file">Read-only lock file</h3>
<p>The developer “Make database read-only” function writes a lock file, whose name and location may be specified in <a href="Manual:LocalSettings.php" title="wikilink">LocalSettings.php</a>. If the file exists, the wiki will (hopefully) avoid operations which write to the database. The contents of the file are a message to be displayed to the poor users experiencing the editing lockout.</p>
<p>It need not be web-shared, but it shouldn't be a security risk to do so. The default location is in the upload directory.</p>
<h3 id="tex-temporary-files">TeX temporary files</h3>
<p>TeX rendering requires a temporary directory to store intermediate files. It need not be web-shared, but it shouldn't be a security risk to do so. These files are only used during the course of producing the rasterized PNG files, and need not be kept or shared.</p>
<h2 id="private-files">Private files</h2>
<h3 id="debug-log">Debug log</h3>
<p>One may optionally <a href="Manual:$wgDebugLogFile" title="wikilink">enable a debug log</a>, which prints all kinds of annoying messages. It should not generally be left on, as this will waste time and space. The debug log includes URLs of all requests to the wiki and sometimes IP addresses, so you may not want to make it publicly available.</p>
<h3 id="session-data">Session data</h3>
<p>A little bit of data for login sessions is handled by <a href="http://www.php.net/session">PHP's session handling</a>. This stores a bunch of small files in the /tmp directory; you can probably configure PHP to store them elsewhere.</p>
<h2 id="see-also">See also</h2>
<ul>
<li></li>
</ul>
<p><a href="Category:MediaWiki_technical_documentation" title="wikilink">Category:MediaWiki technical documentation</a></p>
